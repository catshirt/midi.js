(function(e){var t,n,r;(function(e){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(t,n){return function(){return s.apply(e,p.call(arguments,0).concat([t,n]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(t){if(d(f,t)){var n=f[t];delete f[t],c[t]=!0,i.apply(e,n)}if(!d(a,t)&&!d(c,t))throw new Error("No "+t);return a[t]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(t,n,r,i){var s,l,h,p,v,g=[],w;i=i||t;if(typeof r=="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(v=0;v<n.length;v+=1){p=o(n[v],i),l=p.f;if(l==="require")g[v]=u.require(t);else if(l==="exports")g[v]=u.exports(t),w=!0;else if(l==="module")s=g[v]=u.module(t);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=r.apply(a[t],g);if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!w)a[t]=h}else t&&(a[t]=r)},t=n=s=function(t,n,r,a,f){return typeof t=="string"?u[t]?u[t](n):b(o(t,n).f):(t.splice||(l=t,n.splice?(t=n,n=r,r=null):t=e),n=n||function(){},typeof r=="function"&&(r=a,a=f),a?i(e,t,n,r):setTimeout(function(){i(e,t,n,r)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},r=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},r.amd={jQuery:!0}})(),r("almond",function(){});var i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r("lib/stream",[],function(){var e,t,n;return t=function(){function e(e){this.str=e,this.position=0}return e.prototype.read=function(e){var t;return t=this.str.substr(this.position,e),this.position+=e,t},e.prototype.readInt32=function(){var e,t,n;return n=this.str,e=this.position,t=(n.charCodeAt(e)<<24)+(n.charCodeAt(e+1)<<16)+(n.charCodeAt(e+2)<<8)+n.charCodeAt(e+3),this.position+=4,t},e.prototype.readInt16=function(){var e,t,n;return n=this.str,e=this.position,t=(n.charCodeAt(e)<<8)+n.charCodeAt(e+1),this.position+=2,t},e.prototype.readInt8=function(e){var t;return t=this.str.charCodeAt(this.position),e&&t>127&&(t-=256),this.position+=1,t},e.prototype.eof=function(){return this.position>=this.str.length},e}(),e=function(e){function t(){return n=t.__super__.constructor.apply(this,arguments),n}return s(t,e),t.prototype.readVarInt=function(){var e,t;t=0;for(;;){e=this.readInt8();if(!(e&128))return t+e;t+=e&127,t<<=7}},t.prototype.readChunk=function(){var e,t,n;return t=this.read(4),n=this.readInt32(),e=this.read(n),{id:t,length:n,data:e}},t}(t)}),r("lib/events",[],function(){return{SequenceNumber:function(e,t){return this.type="meta",this.name="sequenceNumber",this.number=e,this.time=t||0},Text:function(e,t){return this.type="meta",this.name="text",this.text=e,this.time=t||0},CopyrightNotice:function(e,t){return this.type="meta",this.name="copyrightNotice",this.text=e,this.time=t||0},TrackName:function(e,t){return this.type="meta",this.name="trackName",this.text=e,this.time=t||0},InstrumentName:function(e,t){return this.type="meta",this.name="instrumentName",this.text=e,this.time=t||0},Lyrics:function(e,t){return this.name="lyrics",this.text=e,this.time=t||0},Marker:function(e,t){return this.type="meta",this.name="marker",this.text=e,this.time=t||0},CuePoint:function(e,t){return this.type="meta",this.name="cuePoint",this.text=e,this.time=t||0},ChannelPrefix:function(e,t){return this.type="meta",this.name="channelPrefix",this.channel=e,this.time=t||0},EndOfTrack:function(e){return this.type="meta",this.name="endOfTrack",this.time=e||0},SetTempo:function(e,t){return this.type="meta",this.name="setTempo",this.microseconds=e,this.time=t||0},SMPTEOffset:function(e,t,n,r,i,s,o){return this.type="meta",this.name="smpteOffset",this.frameRate=e,this.hour=t,this.min=n,this.sec=r,this.frame=i,this.subframe=s,this.time=o||0},TimeSignature:function(e,t,n,r,i){return this.type="meta",this.name="timeSignature",this.numerator=e,this.denominator=t,this.metronome=n,this.thirtyseconds=r,this.time=i||0},KeySignature:function(e,t,n){return this.type="meta",this.name="keySignature",this.key=e,this.scale=t,this.time=n||0},SequencerSpecific:function(e,t){return this.type="meta",this.name="sequencerSpecific",this.data=e,this.time=t||0},NoteOn:function(e,t,n){return this.type="channel",this.name="noteOn",this.number=e,this.velocity=t,this.time=n||0},NoteOff:function(e,t,n){return this.type="channel",this.name="noteOff",this.number=e,this.velocity=t,this.time=n||0},NoteAftertouch:function(e,t,n){return this.type="channel",this.name="noteAftertouch",this.number=e,this.amount=t,this.time=n||0},Controller:function(e,t,n){return this.type="channel",this.name="controller",this.controller=e,this.value=t,this.time=n||0},ProgramChange:function(e,t){return this.type="channel",this.name="programChange",this.number=e,this.time=t||0},ChannelAftertouch:function(e,t){return this.type="channel",this.name="channelAftertouch",this.amount=e,this.time=t||0},PitchBend:function(e,t){return this.type="channel",this.controller=controller,this.value=e,this.time=t||0}}});var i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r("lib/parser",["./stream","./events"],function(e,t){var n,r,i,o,u,a,f,l,c,h;return r=function(){function e(e,t,n){this.stream=e,this.time=t,this.eventTypeByte=n}return e.checkLength=function(e,t,n){var r;r="Expected length for "+e+" event is "+n+", got "+t;if(t!==n)throw r},e}(),o=function(e){function n(){return l=n.__super__.constructor.apply(this,arguments),l}return s(n,e),n.events={0:function(e,n,i){return r.checkLength("SequenceNumber",e,2),new t.SequenceNumber(n.readInt16(),i)},1:function(e,n,r){return new t.Text(n.read(e),r)},2:function(e,n,r){return new t.CopyrightNotice(n.read(e),r)},3:function(e,n,r){return new t.TrackName(n.read(e),r)},4:function(e,n,r){return new t.InstrumentName(n.read(e),r)},5:function(e,n,r){return new t.Lyrics(n.read(e),r)},6:function(e,n,r){return new t.Marker(n.read(e),r)},7:function(e,n,r){return new t.CuePoint(n.read(e),r)},32:function(e,n,i){return r.checkLength("ChannelPrefix",e,1),new t.ChannelPrefix(n.readInt8(),i)},47:function(e,n,i){return r.checkLength("EndOfTrack",e,0),new t.EndOfTrack(i)},81:function(e,n,i){return r.checkLength("SetTempo",e,3),new t.SetTempo((n.readInt8()<<16)+(n.readInt8()<<8)+n.readInt8(),i)},84:function(e,t,n){var i,s;return r.checkLength("SMPTEOffset",e,5),s=t.readInt8(),i={0:24,32:25,64:29,96:30}[s&96],new SMPTEOffset(i,s&31,t.readInt8(),t.readInt8(),t.readInt8(),t.readInt8(),n)},88:function(e,n,i){return r.checkLength("TimeSignature",e,4),new t.TimeSignature(n.readInt8(),Math.pow(2,n.readInt8()),n.readInt8(),n.readInt8(),i)},89:function(e,n,i){return r.checkLength("KeySignature",e,2),new t.KeySignature(n.readInt8(!0),n.readInt8(),i)},127:function(e,n,r){return new t.SequencerSpecific(n.read(e),r)}},n.prototype.parse=function(){var e,t,r;return r=this.stream.readInt8(),t=this.stream.readVarInt(),e=n.events[r],e?e(t,this.stream,this.time):{type:"unknown",time:this.time,data:this.stream.read(t)}},n}(r),n=function(e){function n(){return c=n.__super__.constructor.apply(this,arguments),c}return s(n,e),n.events={8:function(e,n,r){return new t.NoteOff(e,n.readInt8(),r)},9:function(e,n,r){var i,s;return s=n.readInt8(),i=s?"NoteOn":"NoteOff",new t[i](e,s,r)},10:function(e,n,r){return new t.NoteAftertouch(e,n.readInt8(),r)},11:function(e,n,r){return new t.Controller(e,n.readInt8(),r)},12:function(e,n,r){return new t.ProgramChange(e,r)},13:function(e,n,r){return new t.ChannelAftertouch(e,r)},14:function(e,n,r){return new t.PitchBend(e+(n.readInt8()<<7),r)}},n.prototype.parse=function(){var e,t,r,i,s;return i=this.eventTypeByte,(i&128)===0?(s=i,i=this._lastEventTypeByte):(s=this.stream.readInt8(),this._lastEventTypeByte=i),r=i>>4,e=i&15,t=n.events[r],t?t(s,this.stream,this.time):{type:"unknown",time:this.time,channel:e}},n}(r),a=function(e){function n(){return h=n.__super__.constructor.apply(this,arguments),h}return s(n,e),n.events={240:function(e,n){var r;return r=e.readVarInt(),new t.SysEx(e.read(r),n)},247:function(e,n){var r;return r=e.readVarInt(),new t.DividedSysEx(e.read(r),n)}},n.prototype.parse=function(){var e;return e=n.events[this.eventTypeByte],e?e(this.stream,this.time):{type:"unknown",time:this.time}},n}(r),f=function(){function t(e){this.chunk=e}return t.prototype.parse=function(){var t,n,r,i,s,o,u,a;u=this.chunk.id,a=u!=="MTrk";if(a)throw"Unexpected chunk. Expected MTrk, got "+u+".";r=[],s=new e(this.chunk.data);while(!s.eof())o=s.readVarInt(),n=s.readInt8(),t=this.getEventParserByTypeByte(n),i=new t(s,o,n),r.push(i.parse());return r},t.prototype.getEventParserByTypeByte=function(e){return(e&240)!==240?n:e===255?o:a},t}(),i=function(){function t(e){this.chunk=e}return t.prototype.parse=function(){var t,n,r;n=this.chunk.id!=="MThd"||this.chunk.length!==6;if(n)throw"Bad .mid file - header not found";r=new e(this.chunk.data),t={formatType:r.readInt16(),trackCount:r.readInt16(),ticksPerBeat:r.readInt16()},n=t.ticksPerBeat&32768;if(n)throw"Expressing time division in SMTPE frames is not supported yet";return t},t}(),u=function(){function t(e){this.binaryString=e}return t.prototype.parse=function(){var t,n,r,s,o,u,a;s=new e(this.binaryString),n=s.readChunk(),r=new i(n),t=r.parse(),a=[];while(!s.eof())o=s.readChunk(),u=new f(o),a.push(u.parse());return{header:t,tracks:a}},t}()}),r("lib/writer",[],function(){var e;return e=function(){function e(e){this.midi=e}return e.prototype.write=function(){return JSON.stringify(this.midi)},e}()}),r("main",["./lib/parser","./lib/writer","./lib/events"],function(e,t,n){var r;return r=r||window,r.MIDI=function(){function r(t,n){var r,i;typeof t=="string"&&(r=new e(t),i=r.parse(),t=i.header,n=i.tracks),this.header=t,this.tracks=n}return r.Writer=t,r.Parser=e,r.Events=n,r.prototype.write=function(){var e;return e=new t(this),e.write()},r}()}),n(["main"],null,null,!0)})(this);